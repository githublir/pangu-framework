---
title: 基于ShenYu的专业模式
tags: [快速开始,网关]
sidebar_position: 90
slug: /quick-start/how-to-make-gateway-app/shenyu-based
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# 基于Apache ShenYu的高级网关开发

:::info
在上文[《如何开发微服务应用》](/docs/quick-start/how-to-make-microservice-architecture-app)中，我们已经介绍了如何开发一个微服务应用以及微服务模块之间的互相调用。在盘古框架体系下，进行网关开发（将微服务接口发布为WebAPI）有两种方式。第一种是依赖SpringMVC并引入服务接口包显式调用服务接口的方式发布，第二种是依赖盘古网关不需要引入服务接口包通过Dubbo泛化调用服务接口的方式发布。本文将介绍第一种方式。
:::

## 安装相关盘古框架模块

<Tabs>
<TabItem value="parent" label="继承盘古Parent">

```jsx
<parent>
	<groupId>com.gitee.pulanos.pangu</groupId>
	<artifactId>pangu-parent</artifactId>
	<version>latest.version.xxx</version>
	<relativePath/>
</parent>
```
</TabItem>
<TabItem value="dependency1" label="盘古模块①">

```jsx
<dependency>
    <groupId>com.gitee.pulanos.pangu</groupId>
    <artifactId>pangu-spring-boot-starter</artifactId>
</dependency>
```
</TabItem>
<TabItem value="dependency2" label="盘古模块②">

```jsx
<dependency>
	<groupId>com.gitee.pulanos.pangu</groupId>
	<artifactId>pangu-dubbo-spring-boot-starter</artifactId>
</dependency>
```
</TabItem>
<TabItem value="dependency3" label="盘古模块③">

```jsx
<dependency>
    <groupId>com.gitee.pulanos.pangu</groupId>
    <artifactId>pangu-web-spring-boot-starter</artifactId>
</dependency>
```
</TabItem>
<TabItem value="dependency4" label="服务接口包">

```jsx
<dependency>
    <groupId>com.gitee.pulanos.pangu</groupId>
    <artifactId>pangu-examples-dubbo-api</artifactId>
    <version>1.0.0</version>
</dependency>
```

</TabItem>
</Tabs>

:::tip
基于SpringMVC将Dubbo微服务接口发布为WebAPI需要引入服务接口依赖包。
:::

## 本地配置

> 为便于理解，本文基于本地配置的方式编写。若改为标准的Nacos配置中心模式，请参阅:[使用指南->配置中心](/docs/advanced-guide/nacos-config-center)章节。

<Tabs>
<TabItem value="application" label="application.properties">

```jsx
spring.profiles.active=${spring.profiles.active:dev}
```
</TabItem>
<TabItem value="application-dev" label="application-dev.properties">

```jsx {7}
spring.application.name=pangu-examples-dubbo-service

dubbo.protocol.name=dubbo
dubbo.protocol.port=20880
dubbo.consumer.timeout=5000
#服务注册中心地址
dubbo.registry.address=nacos://${nacos.server-addr}?namespace=${nacos.namespace}
dubbo.consumer.check=false

logging.level.root=INFO
logging.level.com.gitee.pulanos.pangu=INFO
```
</TabItem>
</Tabs>

## 调用微服务接口
可以在任何一个SpringBean组件中（针对网关模块而言一般是Controller中），引入服务接口后就像本地接口调用一样调用远程服务。Dubbo将提供高性能的基于代理的远程调用能力，服务以接口为粒度，为开发者屏蔽远程调用底层细节。
如下所示，通过Cotroller调用远程服务接口，实现将微服务接口发布为WebAPI。

```jsx {2,13} title="DemoController.java"
// 注入服务接口
@Reference(version = "1.0.0", group = "pangu-examples-dubbo-service")
private UserService userService;

/**
 * 通过SpringMVC将Duboo微服务接口发布为WebAPI
 * @return
 */
@RequestMapping("/case1")
public Result<List<UserOut>> case1() {
	log.info("call case1...");
	UserIn userIn = new UserIn().setUserType("1");
	List<UserOut> userOuts = userService.listUserOuts(userIn);
	return Result.success(userOuts);
}
```
:::caution
这种通过SpringMVC发布API的模式并非盘古开发的标准姿势，只是提供这么一种开发模式选项。
:::

## 启动入口

```jsx {1,5}
@EnableDubbo
@SpringBootApplication
public class DubboProviderApplication {
	public static void main(String[] args) {
		PanGuApplicationBuilder.init(DubboProviderApplication.class).run(args);
	}
}
```

## 相关参考范例
- [pangu-examples-dubbo-api](https://gitee.com/pulanos/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-api)：服务接口包
- [pangu-examples-dubbo-service](https://gitee.com/pulanos/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-service)：服务提供者
- [pangu-examples-dubbo-gateway-service](https://gitee.com/pulanos/pangu-framework/tree/master/pangu-examples/pangu-examples-dubbo-gateway-service)：服务消费者（基于SpringMVC的网关模块）

## 下一步
继续阅读其它章节获取您想要的答案或通过我们的[开发者社区](/docs/community)寻求更多帮助。